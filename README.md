# relat-rio-report-normal
abap

REPORT Z_PROVA_EDU007.
*PROVA TREINAMENTO ABAP ITEAM-LINS-sp
*22/04/2023.
*eduardo brumati dugaich.
*relatório report normal.
***************************************
*****A*****B********A******P***********
***************************************
***************************************

*TABELAS
TABLES:ZTBS_CLIENTE01,
       ZTBS_VENDAS02,
       ZTBS_PRODUTOS03.


TYPES:
*******************************DECLARAÇÃO DA TABELA DE CLIENTES
*           VAI DEFINIR OS TIPOS DE CAMPOS , ESTRUTAS E TABELAS.

BEGIN OF TY_CLIENTE01,
CODCLI TYPE ZTBS_CLIENTE01-CODCLI,
NOME TYPE ZTBS_CLIENTE01-NOME,
ENDCLI TYPE ZTBS_CLIENTE01-ENDCLI,
CIDCLI TYPE  ZTBS_CLIENTE01-CIDCLI,
ESTCLI TYPE  ZTBS_CLIENTE01-ESTCLI,
END OF TY_CLIENTE01,

********************************DECLARAÇÃO DA TABELAS DE VENDAS.
 BEGIN OF TY_VENDAS02,
   CODVEN TYPE  ZTBS_VENDAS02-CODVEN,
   ITMVEN TYPE  ZTBS_VENDAS02-ITMVEN,
   DATAVEN TYPE  ZTBS_VENDAS02-DATAVEN,
   CODCLI TYPE  ZTBS_VENDAS02-CODCLI,
   CODPRD TYPE  ZTBS_VENDAS02-CODPRD,
   QTDEPRD TYPE  ZTBS_VENDAS02-QTDEPRD,
   VLRPRD TYPE  ZTBS_VENDAS02-VLRPRD,
   END OF TY_VENDAS02,

*********************************DECLARAÇÃO DA TABELA DE PRODUTOS.
   BEGIN OF TY_PRODUTOS03,
     CODPRD TYPE  ZTBS_PRODUTOS03-CODPRD,
     DESCPRD TYPE  ZTBS_PRODUTOS03-DESCPRD,
     PRECOPRD TYPE  ZTBS_PRODUTOS03-PRECOPRD,
     END OF TY_PRODUTOS03,

*********************************DECLARAÇÃO DA TABELA DE SAIDA.
     BEGIN OF TY_SAIDA,
     CODVEN TYPE ZTBS_VENDAS02-CODVEN,
     ITMVEN TYPE ZTBS_VENDAS02-ITMVEN,
     DATAVEN TYPE ZTBS_VENDAS02-DATAVEN,
     CODCLI TYPE ZTBS_VENDAS02-CODCLI,
     NOME TYPE ZTBS_CLIENTE01-NOME,
     CODPRD TYPE ZTBS_VENDAS02-CODPRD,
     DESCPRD TYPE  ZTBS_PRODUTOS03-DESCPRD,
     QTDEPRD TYPE ZTBS_VENDAS02-QTDEPRD,
     VLRPRD TYPE  ZTBS_VENDAS02-VLRPRD,
      END OF TY_SAIDA.

*DECLARAÇÃO DE TABELAS INTERNAS.
*PARA ARMAZENAR MEUS DADOS  QUE SERÃO PROCESSADOS NO PROGRAMA.

    DATA:TI_CLIENTE TYPE TABLE OF TY_CLIENTE01,
          TI_VENDAS02 TYPE TABLE OF TY_VENDAS02,
          TI_PRODUTOS03 TYPE TABLE OF TY_PRODUTOS03,
          TI_SAIDA TYPE TABLE OF TY_SAIDA.



* DECLARAÇÃO DAS WORKAREAS.
*ESTRUTURAS QUE IRÃO COMPOR NA MINHA TABELA INTERNA VALORES DE UMA LINHA DA TABELA

     DATA:W_CLIENTE TYPE TY_CLIENTE01,
           W_VENDAS02 TYPE TY_VENDAS02,
           W_PRODUTOS03 TYPE TY_PRODUTOS03,
           W_SAIDA TYPE TY_SAIDA.



* DECLARAÇÃO DA TELA DE SELEÇÃO
*VAI DEFIRNIR A APARECêNCIA  EO COMPORTAMENTO DA TELA DE SELEÇÃO
*PERMITE AOS USUARIOS INSERIR DADOS DE ENTRADA ANTES DA EXECUÇÃO DO PROGRAMA.

SELECTION-SCREEN BEGIN OF BLOCK A WITH FRAME TITLE text-001.
PARAMETERS: P_CLI TYPE ZTBS_CLIENTE01-CODCLI.
SELECT-OPTIONS S_DATA FOR ZTBS_VENDAS02-DATAVEN.
SELECTION-SCREEN END OF BLOCK A.

*SELECT-OPTIONS é uma declaração ABAP que é usada para criar uma
*tela de seleção para permitir ao
*usuário inserir um ou mais valores de seleção para serem usados ​​em uma
*cláusula WHERE de uma instrução SELECT.
*É semelhante ao PARAMETERS, mas permite a entrada de valores múltiplos.


*****************EVENTO START-OF-SELECTION************************************
* Evento onde são feitas as seleções de dados dos programas.
*EVENTO ONDE O PROGRAMA COMEÇA A SER EXECUTADO.
*PROCESSA-LOS E EXIBI-LOS EM UMA LISTA OU RELATÓRIO

START-OF-SELECTION.

SELECT CODCLI NOME ENDCLI CIDCLI ESTCLI
  FROM  ZTBS_CLIENTE01
  INTO TABLE TI_CLIENTE
  WHERE CODCLI = P_CLI.
  IF SY-SUBRC <> 0.
   MESSAGE e208(oo) WITH 'dados não encontrados'.
   ENDIF.

  SELECT CODVEN ITMVEN DATAVEN CODCLI CODPRD QTDEPRD VLRPRD
    FROM ZTBS_VENDAS02
    INTO TABLE TI_VENDAS02
     WHERE DATAVEN IN S_DATA.

*PARA CONTROLAR O FLUXO DE EXECUÇÃO DO MEU PROGRAMA COM BASE
*EM UMA CONDIÇÃO ...SE SY-SUBRC IGUAL A ZERO PROGRAMA ACEITO DIFERENTE DE ZERO
*EXEMPLO 4 ME DA UMA MESSAAGE DE ERRO .
   IF SY-SUBRC <> 0.
      MESSAGE e208(oo) WITH 'dados não encontrados'.
   ENDIF.

      SELECT CODPRD DESCPRD PRECOPRD
        FROM ZTBS_PRODUTOS03
        INTO TABLE TI_PRODUTOS03
***************************************PARA FILTRA DADOS DE UMA TABELA
        FOR ALL ENTRIES IN TI_VENDAS02
        WHERE CODPRD EQ TI_VENDAS02-CODPRD.
  IF SY-SUBRC <> 0.
    MESSAGE e208(oo) WITH 'dados não localizados'.
  ENDIF.

*************END-OF-SELECTION********************************
*OCORRE NO FINAL DO PROCESSAMENTO DA SELEÇÃO DE UM RELATÓRIO
*  seleção de dados do programa


CLEAR TI_SAIDA.
*USADO PARA LIMPAR OU REDEFINIR VALORES.

*Como pode haver mais de um registro na tabela interna é necessário
*     a utilização do comando LOOP para impressão dos dados
*     LOOP utilizando workarea

* vai ler todas as linhas da minha tabela TI_VENDAS W_VENDAS.
LOOP AT  TI_VENDAS02 INTO W_VENDAS02.
*ESTE COMANDO PROCURA , NA MINHA TABELA TI_VENDAS ALGUM REGISTRO QUE TENHA O MESMO
*CODIGO QUE MINHA TABELA TI_PRODUTOS.

  READ TABLE TI_PRODUTOS03 INTO W_PRODUTOS03 WITH KEY CODPRD = W_VENDAS02-CODPRD.
  IF SY-SUBRC EQ 0.
    ENDIF.

**SE A LIGAÇÃO codigo VENDAS e codigo PRODUTOS funcionou... eu transfiro os dados
*para minha tabela de SAIDA.

*DECLARANDO A TABELA DE SAIDA.
  W_SAIDA-CODVEN = W_VENDAS02-CODVEN.
  W_SAIDA-ITMVEN = W_VENDAS02-ITMVEN.
  W_SAIDA-DATAVEN = W_VENDAS02-DATAVEN.
  W_SAIDA-CODCLI = W_VENDAS02-CODCLI.
  W_SAIDA-NOME = W_CLIENTE-NOME.
  W_SAIDA-CODPRD = W_VENDAS02-CODPRD.
  W_SAIDA-DESCPRD = W_PRODUTOS03-DESCPRD.
  W_SAIDA-QTDEPRD = W_VENDAS02-QTDEPRD.
  W_SAIDA-VLRPRD = W_VENDAS02-VLRPRD.

*DEPOIS  O LOOP VAI  PROCURAR NA TI_CLIENTE a chave codigo mnha tabela de VENDA
*W_VENDAS codigo chave CODCLI.

 READ TABLE  TI_CLIENTE INTO W_CLIENTE WITH KEY CODCLI = W_VENDAS02-CODCLI.
*SE FOR POSSIVEL ME TRAZ OS DADOS
*PARA ADICIONAR UMA  NOVA LINHA AO FINAL DA TABELA INTERNA
*USANDO O CAMANDO APPEND.
 IF SY-SUBRC EQ 0.
   W_SAIDA-CODCLI = W_CLIENTE-CODCLI.
   W_SAIDA-CODCLI = W_CLIENTE-CODCLI.
   ENDIF.

   APPEND W_SAIDA TO TI_SAIDA.
   ENDLOOP.

** ESTA REALIZANDO UM LOOP ATRAVEZ DA TABELA INTERNA DE TI_SAIDA ADICIONANDO
*UMA NOVA LINHA NO FINAL DA TABELA INTERNA USANDO O COMANDO APPEND.
 IF SY-SUBRC = 0.
  FORMAT COLOR 1.
  ULINE /(35).
  WRITE: /1 '|',
          2 'CLIENTES',
          7 '|',
          8 '|',
          9 '|',
          10 'VENDAS',
          14 '|',
          15 '|',
          16 '|',
          15 'PRODUTOS',
          35 '|'.
  ULINE /(35).

   LOOP AT TI_SAIDA INTO W_SAIDA.
     WRITE:/01'|',
            02 W_SAIDA-CODVEN,
            04 '|',
            05 W_SAIDA-ITMVEN,
            09 '|',
            10 W_SAIDA-DATAVEN,
            18 '|',
            19 W_SAIDA-CODCLI,
            30 '|',
            31 W_SAIDA-NOME,
            45 '|',
            46 W_SAIDA-CODPRD,
            60 '|',
            61 W_SAIDA-DESCPRD,
            100 '|',
            101 W_SAIDA-QTDEPRD,
            120 '|',
            140 w_SAIDA-VLRPRD,
            141 '|'.
     ULINE:/(141).

     ENDLOOP.

         ENDIF.
